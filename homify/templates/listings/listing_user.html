{% extends "base.html" %}

{% block title %} My Properties {% endblock title %}

{% block content %}
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0">My Properties</h2>
    <a href="{% url 'listing_new' %}" class="btn btn-primary shadow-sm">
      <i class="bi bi-plus-circle me-1"></i> Add Property
    </a>
  </div>

  {% if properties %}
    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle shadow-sm rounded">
        <thead class="table-dark">
          <tr>
            <th class="text-center">#</th>
            <th>Description</th>
            <th>Category</th>
            <th>Date Added</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for property in properties %}
          <tr>
            <td class="text-center fw-semibold">{{ forloop.counter }}</td>
            <td>{{ property.description }}</td>
            <td><span class="badge bg-info text-dark">{{ property.get_category_display }}</span></td>
            <td>{{ property.created_at|date:"M d, Y" }}</td>
            <td class="text-center">
              <!-- Edit -->
              <a href="{% url 'listing_update' property.id %}" 
                 class="btn btn-sm btn-outline-warning me-1" 
                 title="Edit">
                <i class="bi bi-pencil-square"></i>
              </a>

              <!-- Delete Trigger -->
              <button type="button" 
                      class="btn btn-sm btn-outline-danger" 
                      data-bs-toggle="modal" 
                      data-bs-target="#deleteModal{{ property.id }}"
                      title="Delete">
                <i class="bi bi-trash"></i>
              </button>

              <!-- Delete Confirmation Modal -->
              <div class="modal fade" id="deleteModal{{ property.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content shadow-lg border-0 rounded-3">
                    <div class="modal-header bg-danger text-white rounded-top">
                      <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle me-2"></i> Confirm Delete
                      </h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      Are you sure you want to delete this property?<br>
                      <strong>{{ property.description }}</strong>
                    </div>
                    <div class="modal-footer">
                      <form method="post" action="{% url 'listing_delete' property.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">
                          <i class="bi bi-trash me-1"></i> Yes, Delete
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                          Cancel
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End Modal -->

            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <!-- Empty State -->
    <div class="alert alert-info text-center shadow-sm rounded">
      <i class="bi bi-info-circle me-1"></i> No properties found.
    </div>
  {% endif %}
{% endblock %}
