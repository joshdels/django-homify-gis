{% extends "base.html" %}

{% block title %} My Properties {% endblock title %}

{% block content %}

<style>
  /* Subtle card hover effect */
  .property-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .property-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold mb-0">My Properties</h2>
  <a href="{% url 'listing_new' %}" class="btn btn-primary shadow-sm">
    <i class="bi bi-plus-circle me-1"></i> Add Property
  </a>
</div>

{% if properties %}
<div class="row g-4">
  {% for property in properties %}
  <div class="col-md-6 col-lg-4">
    <div class="card property-card shadow-sm h-100 border-0">
      {% with first_image=property.images.first %}
        {% if first_image %}
          <img src="{{ first_image.image.url }}" 
               class="card-img-top img-fluid rounded-top" 
               alt="Property image" 
               style="height: 220px; object-fit: cover;">
        {% else %}
          <img src="https://via.placeholder.com/400x220" 
               class="card-img-top img-fluid rounded-top" 
               alt="No image" 
               style="height: 220px; object-fit: cover;">
        {% endif %}
      {% endwith %}

      <div class="card-body">
        <h5 class="card-title text-truncate">{{ property.description }}</h5>

        <p class="mb-2 small">
          {{ property.get_category_display }} | {{ property.property_type|title }}
        </p>

        <p class="fw-bold mb-2">â‚±{{ property.price|floatformat:0 }}</p>
        <p class="mb-0 text-muted small">
          <i class="bi bi-calendar me-1"></i>{{ property.created_at|date:"M d, Y" }}
        </p>
      </div>

      <div class="card-footer bg-white border-0 d-flex justify-content-between pt-3">
        <a href="{% url 'listing_update' property.id %}" 
           class="btn btn-sm btn-outline-success">
          <i class="bi bi-pencil-square me-1"></i> Edit
        </a>

        <button type="button" 
                class="btn btn-sm btn-outline-danger" 
                data-bs-toggle="modal" 
                data-bs-target="#deleteModal{{ property.id }}">
          <i class="bi bi-trash"></i> Delete
        </button>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal{{ property.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-sm border-0 rounded-3">
          <div class="modal-header border-bottom-0">
            <h5 class="modal-title">
              <i class="bi bi-exclamation-triangle me-2"></i> Confirm Delete
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this property?<br>
            <strong>{{ property.description }}</strong>
          </div>
          <div class="modal-footer">
            <form method="post" action="{% url 'listing_delete' property.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash me-1"></i> Yes, Delete
              </button>
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- End Modal -->

  </div>
  {% endfor %}
</div>

{% else %}
<div class="alert alert-light border text-center shadow-sm rounded">
  <i class="bi bi-info-circle me-1"></i> No properties found.
</div>
{% endif %}

{% endblock %}
